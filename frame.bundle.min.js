!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("data-capsule",[],t):"object"==typeof exports?exports["data-capsule"]=t():e["data-capsule"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://static.parastorage.com/services/data-capsule/1.0.0/",n.p="undefined"!=typeof window&&window.__STATICS_BASE_URL__||n.p,n(n.s=53)}({0:function(e,t,n){"use strict";class r{constructor(){["setItem","getItem","removeItem","getAllItems"].forEach(e=>{if(this[e]===r.prototype[e])throw new Error(`BaseStorage method [${e}] must be overriden!`)})}setItem(e,t,n){throw n}getItem(e,t){throw t}removeItem(e,t){throw t}getAllItems(e){throw e}static verify(e){if(e instanceof r)return e;throw new Error("This class must extend BaseStorage!")}}e.exports=r},1:function(e,t){const n={NOT_FOUND:new Error("Key was not found in capsule"),SERVER_ERROR:new Error("Failed to perform operarion on server")};e.exports={PREFIX_SEPARATOR:"|",KEY_SEPARATOR:"#",STORAGE_PREFIX:"capsule",NOT_FOUND:n.NOT_FOUND,CONNECTION_MAX_TIMEOUT:2e3,MESSAGE_MAX_TIMEOUT:8e3,SERVER_ERROR:n.SERVER_ERROR,toError:function(e){return Object.values(n).find(t=>t.message===e)||e}}},14:function(e,t,n){"use strict";const r=n(5),o=n(15),s=n(0),{CONNECTION_MAX_TIMEOUT:i,MESSAGE_MAX_TIMEOUT:a}=n(1);e.exports=class extends s{constructor(e,t,n){super(),this.target=e,this.origin=t,this.token=n,this.channel}getChannel(){return this.channel?Promise.resolve(this.channel):o("data-capsule",{target:this.target,origin:this.origin,connectionMaxTimeout:i,messageMaxTimeout:a}).then(e=>(this.channel=e,e))}sendCommand(e,t){const n={data:t};return this.getChannel().then(t=>t([this.token,e,JSON.stringify(n)].join("|")).then(e=>{const[t,n]=r(e.data,"|",2);if("reject"===t)throw n;return JSON.parse(n).data}))}setItem(...e){return this.sendCommand("setItem",e)}getItem(...e){return this.sendCommand("getItem",e)}removeItem(...e){return this.sendCommand("removeItem",e)}getAllItems(...e){return this.sendCommand("getAllItems",e)}}},15:function(e,t,n){e.exports=n(16)},16:function(e,t,n){"use strict";var r=n(4),o=n(3),s=function(e){return e&&e.__esModule?e:{default:e}}(n(17));e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.targetOrigin,i=void 0===n?"*":n,a=t.connectionMaxTimeout,u=void 0===a?r.deafultConnectionMaxTimeout:a,c=t.messageMaxTimeout,f=void 0===c?r.deafultMessageMaxTimeout:c;return new Promise(function(t,n){setTimeout(function(){n(new Error("max timeout of "+u+"ms exceeded"))},u);var a=new window.MessageChannel;a.port1.onmessage=function(e){if(e.data===r.connectionSuccessMsg)return t((0,s.default)(a.port1,{messageMaxTimeout:f}));n(new Error("connection could not establise"))};var c=(0,o.constructConnectionMessage)(e);window.parent.postMessage(c,i,[a.port2])})}},17:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t.messageMaxTimeout,s={};return e.onmessage=function(e){var t=(0,r.parseChannelMessage)(e.data),n=t.id,o=t.payload;if(s[n]){var i={data:o,origin:e.origin,lastEventId:e.lastEventId,source:e.source,ports:e.ports};s[n](i)}},function(t,i){return new Promise(function(a,u){setTimeout(function(){u(new Error("max timeout of "+n+"ms exceeded"))},n);var c=(0,o.default)(),f=(0,r.constructChannelMessage)(t,c);return s[c]=a,e.postMessage(f,i)})}};var r=n(3),o=function(e){return e&&e.__esModule?e:{default:e}}(n(18))},18:function(e,t,n){var r=n(19),o=n(20);e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||r)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var a=0;a<16;++a)t[s+a]=i[a];return t||o(i)}},19:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},20:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,o=n;return[o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],"-",o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]],o[e[r++]]].join("")}},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseConnectionMessage=t.constructConnectionMessage=t.parseChannelMessage=t.constructChannelMessage=void 0;var r=n(4);t.constructChannelMessage=function(e,t){return t?t+r.messageDelimiter+e:e},t.parseChannelMessage=function(e){var t=e.indexOf(r.messageDelimiter);return-1===t?{id:null,payload:e}:{id:e.slice(0,t),payload:e.slice(t+1)}},t.constructConnectionMessage=function(e){return r.connectionRequestMsg+r.messageDelimiter+e},t.parseConnectionMessage=function(e){var t=e.indexOf(r.messageDelimiter);if(-1===t||e.slice(0,t)!==r.connectionRequestMsg)throw new Error("Invalid connection message");return e.slice(t+1)}},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.connectionRequestMsg="req_con",t.connectionSuccessMsg="connection_success",t.messageDelimiter="|",t.deafultConnectionMaxTimeout=200,t.deafultMessageMaxTimeout=5e3},5:function(e,t,n){"use strict";e.exports=function(e,t,n){var r=e.split(t,n);if(r.length===n){var o=0;o="string"==typeof t?r.join(t).length:r.reduce(function(r,o,s){var i=0;return s+1<n&&(i=e.slice(r).match(t).shift().length),r+o.length+i},0),r[n-1]+=e.slice(o)}return r}},53:function(e,t,n){"use strict";const r=n(54);"undefined"!=typeof window&&(window.DataCapsuleTools=r),e.exports=r},54:function(e,t,n){"use strict";const r=n(14),{NOT_FOUND:o}=n(1),s=n(0),i=n(8);e.exports={NOT_FOUND:o,BaseStorage:s,DataCapsule:i,FrameStorageStrategy:r}},8:function(e,t,n){"use strict";const r=n(0);function o(e,t){return function(e){if(!e.namespace)throw new Error("namespace is required");if("string"!=typeof e.namespace)throw new Error("namespace should be a string")}(t=Object.assign({},e,t)),t}e.exports=class extends r{constructor({strategy:e,namespace:t,scope:n}){super(),this.storageStrategy=r.verify(e),this._options={namespace:t,scope:n}}setItem(e,t,n){return n=o(this._options,n),this.storageStrategy.setItem(e,t,n)}getItem(e,t){return t=o(this._options,t),this.storageStrategy.getItem(e,t)}removeItem(e,t){return t=o(this._options,t),this.storageStrategy.removeItem(e,t)}getAllItems(e){return e=o(this._options,e),this.storageStrategy.getAllItems(e)}}}})});
//# sourceMappingURL=frame.bundle.min.js.map