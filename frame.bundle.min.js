!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("data-capsule",[],t):"object"==typeof exports?exports["data-capsule"]=t():e["data-capsule"]=t()}("undefined"!=typeof self?self:this,function(){return function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="https://static.parastorage.com/services/data-capsule/1.0.0/",n.p="undefined"!=typeof window&&window.__STATICS_BASE_URL__||n.p,n(n.s=53)}({0:function(e,t){var n=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),["setItem","getItem","removeItem","getAllItems"].forEach(function(n){if(t[n]===e.prototype[n])throw new Error("BaseStorage method ["+n+"] must be overriden!")})}return e.prototype.setItem=function(e,t,n){throw n},e.prototype.getItem=function(e,t){throw t},e.prototype.removeItem=function(e,t){throw t},e.prototype.getAllItems=function(e){throw e},e.verify=function(t){if(t instanceof e)return t;throw new Error("This class must extend BaseStorage!")},e}();e.exports=n},1:function(e,t){var n={NOT_FOUND:new Error("Key was not found in capsule"),SERVER_ERROR:new Error("Failed to perform operarion on server")};e.exports={PREFIX_SEPARATOR:"|",KEY_SEPARATOR:"#",STORAGE_PREFIX:"capsule",NOT_FOUND:n.NOT_FOUND,CONNECTION_MAX_TIMEOUT:2e3,MESSAGE_MAX_TIMEOUT:8e3,SERVER_ERROR:n.SERVER_ERROR,toError:function(e){return Object.values(n).find(function(t){return t.message===e})||e}}},14:function(e,t,n){var o=n(5),r=n(15),i=n(0),s=n(1),a=s.CONNECTION_MAX_TIMEOUT,u=s.MESSAGE_MAX_TIMEOUT,c=function(e){function t(n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return i.target=n,i.origin=o,i.token=r,i.channel=void 0,i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.getChannel=function(){var e=this;return this.channel?Promise.resolve(this.channel):r("data-capsule",{target:this.target,origin:this.origin,connectionMaxTimeout:a,messageMaxTimeout:u}).then(function(t){return e.channel=t,t})},t.prototype.sendCommand=function(e,t){var n=this,r={data:t};return this.getChannel().then(function(t){return t([n.token,e,JSON.stringify(r)].join("|")).then(function(e){var t=o(e.data,"|",2),n=t[0],r=t[1];if("reject"===n)throw r;return JSON.parse(r).data})})},t.prototype.setItem=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendCommand("setItem",t)},t.prototype.getItem=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendCommand("getItem",t)},t.prototype.removeItem=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendCommand("removeItem",t)},t.prototype.getAllItems=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.sendCommand("getAllItems",t)},t}(i);e.exports=c},15:function(e,t,n){e.exports=n(16)},16:function(e,t,n){"use strict";var o=n(4),r=n(3),i=function(e){return e&&e.__esModule?e:{default:e}}(n(17));e.exports=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.targetOrigin,s=void 0===n?"*":n,a=t.connectionMaxTimeout,u=void 0===a?o.deafultConnectionMaxTimeout:a,c=t.messageMaxTimeout,f=void 0===c?o.deafultMessageMaxTimeout:c;return new Promise(function(t,n){setTimeout(function(){n(new Error("max timeout of "+u+"ms exceeded"))},u);var a=new window.MessageChannel;a.port1.onmessage=function(e){if(e.data===o.connectionSuccessMsg)return t((0,i.default)(a.port1,{messageMaxTimeout:f}));n(new Error("connection could not establise"))};var c=(0,r.constructConnectionMessage)(e);window.parent.postMessage(c,s,[a.port2])})}},17:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){var n=t.messageMaxTimeout,i={};return e.onmessage=function(e){var t=(0,o.parseChannelMessage)(e.data),n=t.id,r=t.payload;if(i[n]){var s={data:r,origin:e.origin,lastEventId:e.lastEventId,source:e.source,ports:e.ports};i[n](s)}},function(t,s){return new Promise(function(a,u){setTimeout(function(){u(new Error("max timeout of "+n+"ms exceeded"))},n);var c=(0,r.default)(),f=(0,o.constructChannelMessage)(t,c);return i[c]=a,e.postMessage(f,s)})}};var o=n(3),r=function(e){return e&&e.__esModule?e:{default:e}}(n(18))},18:function(e,t,n){var o=n(19),r=n(20);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var s=(e=e||{}).random||(e.rng||o)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,t)for(var a=0;a<16;++a)t[i+a]=s[a];return t||r(s)}},19:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var o=new Uint8Array(16);e.exports=function(){return n(o),o}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},20:function(e,t){for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);e.exports=function(e,t){var o=t||0,r=n;return[r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],"-",r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]],r[e[o++]]].join("")}},3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.parseConnectionMessage=t.constructConnectionMessage=t.parseChannelMessage=t.constructChannelMessage=void 0;var o=n(4);t.constructChannelMessage=function(e,t){return t?t+o.messageDelimiter+e:e},t.parseChannelMessage=function(e){var t=e.indexOf(o.messageDelimiter);return-1===t?{id:null,payload:e}:{id:e.slice(0,t),payload:e.slice(t+1)}},t.constructConnectionMessage=function(e){return o.connectionRequestMsg+o.messageDelimiter+e},t.parseConnectionMessage=function(e){var t=e.indexOf(o.messageDelimiter);if(-1===t||e.slice(0,t)!==o.connectionRequestMsg)throw new Error("Invalid connection message");return e.slice(t+1)}},4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.connectionRequestMsg="req_con",t.connectionSuccessMsg="connection_success",t.messageDelimiter="|",t.deafultConnectionMaxTimeout=200,t.deafultMessageMaxTimeout=5e3},5:function(e,t,n){"use strict";e.exports=function(e,t,n){var o=e.split(t,n);if(o.length===n){var r=0;r="string"==typeof t?o.join(t).length:o.reduce(function(o,r,i){var s=0;return i+1<n&&(s=e.slice(o).match(t).shift().length),o+r.length+s},0),o[n-1]+=e.slice(r)}return o}},53:function(e,t,n){var o=n(54);"undefined"!=typeof window&&(window.DataCapsuleTools=o),e.exports=o},54:function(e,t,n){var o=n(14),r=n(1).NOT_FOUND,i=n(0),s=n(8);e.exports={NOT_FOUND:r,BaseStorage:i,DataCapsule:s,FrameStorageStrategy:o}},8:function(e,t,n){var o=n(0);function r(e,t){return function(e){if(!e.namespace)throw new Error("namespace is required");if("string"!=typeof e.namespace)throw new Error("namespace should be a string")}(t=Object.assign({},e,t)),t}var i=function(e){function t(n){var r=n.strategy,i=n.namespace,s=n.scope;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,e.call(this));return a.storageStrategy=o.verify(r),a._options={namespace:i,scope:s},a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t.prototype.setItem=function(e,t,n){return n=r(this._options,n),this.storageStrategy.setItem(e,t,n)},t.prototype.getItem=function(e,t){return t=r(this._options,t),this.storageStrategy.getItem(e,t)},t.prototype.removeItem=function(e,t){return t=r(this._options,t),this.storageStrategy.removeItem(e,t)},t.prototype.getAllItems=function(e){return e=r(this._options,e),this.storageStrategy.getAllItems(e)},t}(o);e.exports=i}})});
//# sourceMappingURL=frame.bundle.min.js.map